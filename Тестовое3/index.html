<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft header</title>
    <link rel="SHORTCUT ICON" href="https://c.s-microsoft.com/favicon.ico?v2" type="image/x-icon">
    <link rel="stylesheet" href="./style.css">
</head>
<body>

    <header class="">
        <div class="wrapper">
            <button class="header__burger-open">

            </button>

            <button class="header__search-mobile"></button>

            <a href="#" class="header__logo">
                <img src="https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31" alt="img">
            </a>

            <div class="header__pagename"><a href="#"><span>Surface</span></a></div>

            <nav class="header__navigation header__navigation-left">
                <ul class="header__navigation_list">
                    <li class="navigation_list_item has-child"><a href="#"><span>Computers</span></a></li>
                    <li class="navigation_list_item has-child"><a href="#"><span>Computers for Business</span></a></li>
                    <li class="navigation_list_item has-child"><a href="#"><span>Accessories</span></a></li>
                    <li class="navigation_list_item has-child"><a href="#"><span>Shop now</span></a></li>
                    <li class="navigation_list_item header__support"><a href="#"><span>Support</span></a></li>
                    <li id="navigation_more-list">
                        <button class="more-list_open-btn">More</button>
                        <ul class="more-list_container" style="position: absolute; opacity: 0; visibility: hidden; pointer-events: none;"></ul>
                    </li>
                </ul>
            </nav>

            <nav class="header__navigation header__navigation-right">
                <ul class="header__navigation_list">
                    <li class="navigation_list_item has-child header__all-microsoft"><a href="#"><span>All Microsoft</span></a></li>
                    <li class="navigation_list_item header__search"><a href="#"><span>Search</span><span class="tip">Search Microsoft.com</span></a></li>
                    <li class="navigation_list_item header__cart"><a href="#"><span>Cart</span><span class="tip">0 items in shopping cart</span></a></li>
                    <li class="navigation_list_item header__sign-in"><a href="#">
                        <span>Sign in</span>
                        <svg xmlns="http://www.w3.org/2000/svg"width="32" height="32" viewBox="0 0 64 64" stroke="#707070"><g class="mectrl_stroke" stroke-width="1.9" fill="none"><circle cx="32" cy="32" r="30.25"/><g transform="matrix(1.1 0 0 1.1 8.8 5.61)"><circle class="mectrl_stroke" cx="20" cy="16" r="7"/><path class="mectrl_stroke" d="M30 35h10m-5-5v10M30.833 32.09A11 11 0 009 34"/></g></g></svg>
                    </a></li>
                </ul>
            </nav>

            <div class="header__search-blk">
                <button class="header__search_close-mobile"></button>

                <div class="header__search-group">
                    <input placeholder="Search Microsoft.com" type="search" name="search bar" id="searchBar" class="header__search_input">
                    <button class="header__search_search-btn"><span class="tip">Search Microsoft.com</span></button>
                </div>

                <button class="header__search_close">Cancel</button>
            </div>
        </div>
        <div class="header__pagename-mobile">
            <button class="header__pagename-mobile_text">Surface</button>
            <span class="header__pagename-mobile_ico"></span>
        </div>

        <div class="header__burger-menu">
            <ul class="burger-menu_list">
                <li class="burger-menu_item"><a href="#">Microsoft 365</a></li>
                <li class="burger-menu_item"><a href="#">Office</a></li>
                <li class="burger-menu_item"><a href="#">Windows</a></li>
                <li class="burger-menu_item"><a href="#">Surface</a></li>
                <li class="burger-menu_item"><a href="#">Xbox</a></li>
                <li class="burger-menu_item"><a href="#">Deals</a></li>
                <li class="burger-menu_item"><a href="#">Support</a></li>
                <li class="burger-menu_item has-child"><a href="#">Software</a></li>
                <li class="burger-menu_item has-child"><a href="#">PCs & Devices</a></li>
                <li class="burger-menu_item has-child"><a href="#">Entertainment</a></li>
                <li class="burger-menu_item has-child"><a href="#">Business</a></li>
                <li class="burger-menu_item has-child"><a href="#">Developer & IT</a></li>
                <li class="burger-menu_item has-child"><a href="#">Other</a></li>
                <li class="burger-menu_item"><a href="#">View Sitemap</a></li>
            </ul>
        </div>
    </header>
    
</body>
</html>

<style>
</style>

<script>

    const leftNav = document.querySelector(".header__navigation-left");
    const rightNav = document.querySelector(".header__navigation-right");
    const blockContainer = document.querySelector(".more-list_container");
    const moreList = document.querySelector("#navigation_more-list")

    const distancebetween =  80;

    function getDistanceBetween(left, right){
        let leftRightCornerCoords = Number(getComputedStyle(left).width.slice(0,-2)) + left.getBoundingClientRect().x;
        let rightRightCornerCoords = right.getBoundingClientRect().x;

        return rightRightCornerCoords - leftRightCornerCoords;
    }

    function updateNav(){
        let distance = getDistanceBetween(leftNav, rightNav);
        
        // Если дистанция маленькая, то убираем элементы
        if(distance <= distancebetween){
            let elemContainer = leftNav.querySelector(".header__navigation_list");
            let elemList  = elemContainer.children;

            if(elemList.length > 1){
                let lastElem = elemList[elemList.length-2];
                let lastElemWidth = getComputedStyle(lastElem).width.slice(0,-2)
                
                elemContainer.removeChild(lastElem);
                lastElem.setAttribute("w", Math.floor(lastElemWidth));
                blockContainer.appendChild(lastElem);
                lastElem = elemList[elemList.length-2];
            }
            
        }
        // Если дистанции достаточно, то возвращаем из обратно
        else if(distance > distancebetween){
            let blockContainerChilds = blockContainer.children;

            if(blockContainerChilds.length>0){
                let blockContainerLast = blockContainerChilds[blockContainerChilds.length-1];
                let navigationBlock = leftNav.querySelector(".header__navigation_list");

                if(Number(blockContainerLast.getAttribute("w")) + distancebetween < (distance)){
                    let elemContainer = leftNav.querySelector(".header__navigation_list");

                    blockContainer.removeChild(blockContainerLast);
                    blockContainerLast.removeAttribute("w");
                    navigationBlock.insertBefore(blockContainerLast,moreList);
                }
            }

            
        }
    
        blockContainer.innerHTML != "" ? moreList.classList.add("active") : moreList.classList.remove("active");
    }


    window.addEventListener("resize", ()=>{
        updateNav();
    })

    window.addEventListener("DOMContentLoaded", ()=>{
        let listItemsAmount =  leftNav.querySelectorAll(".navigation_list_item");
        listItemsAmount.forEach(()=>{
            updateNav();
        })

    })


    const searchOpen = document.querySelectorAll(".header__search-mobile, .header__search");
    const header = document.querySelector("header");
    const searchClose = document.querySelectorAll(".header__search_close, .header__search_close-mobile")

    // Открытие поиска
    searchOpen.forEach((el)=>{
        el.addEventListener("click", ()=>{
            header.classList.add("search");
        })
    })

    // Закрытие поиска
    searchClose.forEach((el)=>{
        el.addEventListener("click", ()=>{
            header.classList.remove("search");
        })
    })

    // Закрытие поиска при клике вне его блока
    // Проверяем есть ли в пути блока класс header__search-blk
    // И, если нету, то убираем класс с хедера (закрываем поиск)
    function CheckClass(el, Class){
        return el.classList != undefined ? el.classList.contains(Class) : false;
    }

    document.addEventListener("click", (e)=>{
        if(header.classList.contains("search")){

            e.path.some((el)=>{
               return CheckClass(el, "header__search-blk")
            }) || 
            e.path.some((el)=>{
               return CheckClass(el, "header__search")
            }) 
            || 
            e.path.some((el)=>{
               return CheckClass(el, "header__search-mobile")
            }) 
            ? console.log("open") : header.classList.remove("search");

            

        }
    })
    
    const burgerBtn = document.querySelector(".header__burger-open")
    
    burgerBtn.addEventListener("click", ()=>{
        header.classList.contains("burger-opened") ? header.classList.remove("burger-opened") : header.classList.add("burger-opened")
        header.classList.contains("burger-opened") ? burgerBtn.classList.add("active") : burgerBtn.classList.remove("active")
    })
    

</script>